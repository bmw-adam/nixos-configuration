@page "/counter"

<PageTitle>Counter</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Counter</MudText>

<Microsoft.AspNetCore.Components.Authorization.AuthorizeView>
    <Authorized>
        @context.User.Identity?.Name
    </Authorized>
    <NotAuthorized>
        <MudText>Not logged in</MudText>
    </NotAuthorized>
</Microsoft.AspNetCore.Components.Authorization.AuthorizeView>

@if (_group != null)
{
    <SortableList Id="@ListId" Put="false" GroupModel="@_group" Handle=".drag-handle" Context="item"
        OnUpdate="@SortList" ForceFallback="false">
        <SortableItemTemplate>
            <MudStack StretchItems="StretchItems.Middle" Row>
                <MudIconButton Icon="@Icons.Material.Filled.DragIndicator" class="drag-handle"></MudIconButton>
                <MudButton EndIcon="@Icons.Material.Filled.Info">@item.Name</MudButton>
                <MudText>@item.Id</MudText>
            </MudStack>
        </SortableItemTemplate>
    </SortableList>
}

<MudStack Row Spacing="5">
    <MudButton Color="Color.Secondary" Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Cancel">Zrušit
    </MudButton>
    <MudButton Color="Color.Info" Variant="Variant.Outlined" StartIcon="@Icons.Material.Filled.Save">Ok</MudButton>
</MudStack>

@code {
    public List<Item> items = Enumerable.Range(1, 10).Select(i => new Item { Id = i, Name = $"Item {i}" }).ToList();


    public class Item
    {
        public int Id { get; set; }
        public string Name { get; set; } = "";

        public bool Disabled { get; set; } = false;
    }

    private const string ListId = "sortable";

    private SingleSortableListGroup<Item>? _group = null;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        var settings = new SortableListSettings
        {
            MultiSelection = false,
            SwapThreshold = 0.85,
            FallbackOnBody = true,
            CssForSelection = "color: red"
        };

        _group = new(ListId, new SortableListModel<Item>(items)
        {
            Settings = settings
        });

    }
    private void SortList((int oldIndex, int newIndex) indices)
    {
        Console.WriteLine($"Indicies: adsf");
        var (oldIndex, newIndex) = indices;

        var items = this.items;
        var itemToMove = items[oldIndex];
        items.RemoveAt(oldIndex);

        if (newIndex < items.Count)
        {
            items.Insert(newIndex, itemToMove);
        }
        else
        {
            items.Add(itemToMove);
        }

        Console.WriteLine($"Indicies: {items.Count}");
        StateHasChanged();
    }
}